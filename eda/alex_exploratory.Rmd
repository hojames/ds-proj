---
title: "exploratory_Alex"
author: "alex"
date: "11/29/2017"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r}
library(ggplot2)
library(dplyr)
library(tidyverse)
library(ggthemes)
library(gridExtra)
```

## general analysis

Order of Counties with the Lowest LE (Lowest - Highest)
```{r}
ind <- order(ledata$LE2014) 
ledata$county[ind] 
ledata$state[ind]
```

Order of Counties with the largest decreased LE (from 2010 - 2014)
```{r}
ind <- order(ledata$change) 
ledata$county[ind] 
ledata$change[ind]
```

Average change in LE from 2010 - 2014 in States: 
```{r}
lestate <- ledata[!grepl("County", ledata$county),]
lestate <- lestate[!grepl("Area", lestate$county),]
lestate <- lestate[!grepl("Municipality", lestate$county),]
lestate <- lestate[!grepl("Borough", lestate$county),]
lestate <- lestate[!grepl("Parish", lestate$county),]
lestate <- lestate[!grepl("City", lestate$county),]
```

find lowest state
```{r}
ind <- order(lestate$change) 
lestate$state[ind] 
lestate$change[ind]
```

All Cause Mortality in Mississippii and West Virginia
```{r}
States <- c("Mississippi", "West Virginia")
labels <- data.frame(location_name = States, x = c(2013,2012), y = c(1025,992))
two <- AllMortality %>% filter(location_name %in% c("Mississippi", "West Virginia"))
two2 <- filter(two, cause_id == 294, sex_id == 3) 
p1 <-  ggplot(data = two2, aes(year_id, mx, col = location_name)) 
p1 +  geom_line() +
   geom_text(data = labels, aes(x, y, label = States), size = 5) +
   theme(legend.position = "none")
```

But how does that compare to the state that had the most improved LE from 2010 - 2014?
```{r}
State <- c("Mississippi", "West Virginia", "California")
label <- data.frame(location_name = State, x = c(2013,2012, 2013), y = c(1010,975, 700))
three <- AllMortality %>% filter(location_name %in% c("Mississippi", "West Virginia", "California"))
three2 <- filter(three, cause_id == 294, sex_id == 3) 
p1 <-  ggplot(data = three2, aes(year_id, mx, col = location_name)) 
p1 +  geom_line() +
   geom_text(data = label, aes(x, y, label = State), size = 5) +
   theme(legend.position = "none")
```

How do these two states fare in the CHR ranking?
```{r}
ind <- order(IV$HO_rank) 
IV$State[ind] 
IV$HO_rank[ind]
```

_______________________________________________________________________

Cause of death in 2010
```{r}
bothmortality <- filter(AllMortality, sex_id == 3) 

p2 <- ggplot(data = bothmortality, aes(cause_id, year_id)) 
p2 + geom_point()

mort2010 <- filter(bothmortality, year_id == 2010)
p1 <- ggplot(data = mort2010, aes(cause_id))
p1 + geom_histogram()
```

HIV/AIDS/TB death across years

```{r}
hivaids <- filter(bothmortality, cause_id == 296)
p2 <- ggplot(data = hivaids, aes(year_id)) 
p2 + geom_histogram(bins = 30)
```

Reduced All Cause by state
```{r}
bothstate <- filter(state_mortality, sex_id == 3)
allcause <- filter(bothstate, cause_id == 294)

allcause <- allcause %>% group_by(location_id, region, year_id, state, abb) %>%
     summarize(mean_mx = mean(mx),
               sd_mx = sd(mx),
               n = n()) 

p3 <- ggplot(data = allcause, aes(region, mean_mx)) 
p3 + geom_point()
```

Breakdown by year
```{r}
g <- allcause %>% filter(year_id == 2010) %>%
  group_by(year_id) %>%
  ggplot(aes(region, mean_mx)) + 
  geom_point() +
  xlab("Region") +
  ylab("Mean All-Cause Mortality") +
  theme(axis.text.x = element_text(angle = 90, hjust = 1))

h <- allcause %>% filter(year_id == 2011) %>%
  group_by(year_id) %>%
  ggplot(aes(region, mean_mx)) + 
  geom_point() +
  xlab("Region") +
  ylab("Mean All-Cause Mortality") +
  theme(axis.text.x = element_text(angle = 90, hjust = 1)) 

i <- allcause %>% filter(year_id == 2012) %>%
  group_by(year_id) %>%
  ggplot(aes(region, mean_mx)) + 
  geom_point() +
  xlab("Region") +
  ylab("Mean All-Cause Mortality") +
  theme(axis.text.x = element_text(angle = 90, hjust = 1))

k <- allcause %>% filter(year_id == 2013) %>%
  group_by(year_id) %>%
  ggplot(aes(region, mean_mx)) + 
  geom_point() +
  xlab("Region") +
  ylab("Mean All-Cause Mortality") +
  theme(axis.text.x = element_text(angle = 90, hjust = 1))

z <- allcause %>% filter(year_id == 2014) %>%
  group_by(year_id) %>%
  ggplot(aes(region, mean_mx)) + 
  geom_point() +
  xlab("Region") +
  ylab("Mean All-Cause Mortality") +
  theme(axis.text.x = element_text(angle = 90, hjust = 1))
grid.arrange(g, h, i, k, z)
```

Reduced to South - looking at cause of death
```{r}
bothstate <- filter(state_mortality, sex_id == 3)
southmort <- filter(bothstate, region == "South")

southmort <- southmort %>% group_by(cause_id, cause_name, location_id, region, year_id, state, abb) %>%
     summarize(mean_mx = mean(mx),
               sd_mx = sd(mx),
               n = n()) 
```

