---
title: "exploratory_Alex"
author: "alex"
date: "11/29/2017"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r}
library(ggplot2)
library(dplyr)
library(tidyverse)
library(ggthemes)
library(gridExtra)
```

## EDA

Order of Counties with the Lowest LE (Lowest - Highest)
```{r}
load(file = "finalLE.rda")
file.exists("finalLE.rda")
ind <- order(ledata$LE2014) 
ledata$county[ind] 
ledata$state[ind]
```

Order of Counties with the largest decreased LE (from 2010 - 2014)
```{r}
ind <- order(ledata$change) 
ledata$county[ind] 
ledata$change[ind]
```

Average change in LE from 2010 - 2014 in States: 
```{r}
lestate <- ledata[!grepl("County", ledata$county),]
lestate <- lestate[!grepl("Area", lestate$county),]
lestate <- lestate[!grepl("Municipality", lestate$county),]
lestate <- lestate[!grepl("Borough", lestate$county),]
lestate <- lestate[!grepl("Parish", lestate$county),]
lestate <- lestate[!grepl("City", lestate$county),]
```

find lowest state
```{r}
ind <- order(lestate$change) 
lestate$state[ind] 
lestate$change[ind]
```

Graph of change in le (from 2010-2014) in each county in Mississippi and West Virginia 
```{r}
mle <- ledata %>% mutate(rn = row_number()) %>% filter(rn <= 1509, rn >= 1427)
wvle <- ledata %>% mutate(rn = row_number()) %>% filter(rn <= 3097, rn >= 3042)

P1 <- ggplot(data = mle, aes(county,  change)) +
  geom_boxplot() +
  geom_hline(yintercept = -0.04, col = "red") +
  theme(axis.text.x = element_text(angle = 90, hjust = 1)) +
  ylab("Change in LE") +
  ggtitle("Change in Life Expectancy from 2010 - 2014 across Mississippi") +
   theme(legend.position = "none") 
G1 <- ggplot(data = wvle, aes(county,  change)) +
  geom_boxplot() +
  geom_hline(yintercept = -0.04, col = "red") +
  theme(axis.text.x = element_text(angle = 90, hjust = 1)) +
  ylab("Change in LE") +
  ggtitle("Change in Life Expectancy from 2010 - 2014 across West Virginia") +
   theme(legend.position = "none") 
grid.arrange(P1, G1)
```

How many counties had negative change in LE
```{r}
sum(mle$change < 0) #55 out of 82 counties have negative changes in LE in Mississippi
sum(wvle$change <0) #34 out of 55 counties have negative changes in LE in West Virginia
```

All Cause Mortality in Mississippii and West Virginia
```{r}
States <- c("Mississippi", "West Virginia")
label <- data.frame(location_name = States, x = c(2013,2012), y = c(1025,992))
two <- AllMortality %>% filter(location_name %in% c("Mississippi", "West Virginia"))
two2 <- filter(two, cause_id == 294, sex_id == 3) 
p1 <-  ggplot(data = two2, aes(year_id, mx, col = location_name)) 
p1 +  geom_line() +
   geom_text(data = label, aes(x, y, label = States), size = 5) +
  ggtitle("All Cause Mortality from 2010 - 2014") +
   theme(legend.position = "none")
```


But how does that compare to the state that had the most improved LE from 2010 - 2014?
```{r}
State <- c("Mississippi", "West Virginia", "California")
label <- data.frame(location_name = State, x = c(2013,2012, 2013), y = c(1010,975, 700))
three <- AllMortality %>% filter(location_name %in% c("Mississippi", "West Virginia", "California"))
three2 <- filter(three, cause_id == 294, sex_id == 3) 
p1 <-  ggplot(data = three2, aes(year_id, mx, col = location_name)) 
p1 +  geom_line() +
   geom_text(data = label, aes(x, y, label = State), size = 5) +
  ggtitle("All Cause Mortality from 2010-2015") +
   theme(legend.position = "none")
```

How do the worst counties in each state for change in LE fair in the CHR ranking?
```{r}
ind <- order(mle$change) 
mle$county[ind] #Grenada County, -0.52
mle$change[ind]

ind <- order(wvle$change) 
wvle$county[ind] #Logan County, 
wvle$change[ind] #-0.37

#find rank
IV2 <- dplyr::filter(IV, State == c("West Virginia", "Mississippi"))
Grenada <- IV2 %>% filter(County == "Grenada")
Logan <- IV2 %>% filter(County == "Logan")
Logan # Logan ranked 49 in 2011 and 51 in 2015 out of 55
Grenada # Grenada ranked 54 in 2013 and 51 in 2015 out of 82
```

